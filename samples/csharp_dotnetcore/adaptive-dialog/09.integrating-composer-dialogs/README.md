# Integrating composer dialogs with V4 bots

This bot sample demonstrates how to integrate Dialogs generated by [Bot Framework Composer](https://github.com/microsoft/botframework-composer) to your existing V4 SDK based bot.

It starts with [19.custom-dialogs][s1] sample and shows how to get adaptive dialogs and custom/ waterfall dialogs work together.

## Steps to add composer dialogs to a V4 bot
1. Update all packages to 4.9.x from Nuget
2. Add the following packages
    - `Microsoft.Bot.Builder.Dialogs.Declarative`
    - `Microsoft.Bot.Builder.Dialogs.Adaptive`
3. Update startup.cs and add resource explorer to find and load declarative assets.
4. Add and configure **DialogManager** in `DialogBot.cs`. This internally takes care of saving state on each turn.
5. Update adapter to use storage, conversation state and user state.
6. Add/ update HostBuilder (see program.cs) to load in all relevant appsettings.json as well as composer generated settings file
7. Update appsettings.json with required settings for composer.
8. Use BotFramework Composer to build a bot. 
    - Navigate to the folder on your local machine where your composer bot is. 
    - Locate and copy over contents of `composerBot` folder.
9. Add the composer dialog to your RootDialog.
10. If your composer dialog uses LUIS in any of its recognizers, set up the necessary [LUIS configuration](#luis-configuration)

## Prerequisites

- [.NET Core SDK](https://dotnet.microsoft.com/download) version 3.1

  ```bash
  # determine dotnet version
  dotnet --version
  ```
- [Bot framework composer][composer]

## To try this sample

- Clone the repository

    ```bash
    git clone https://github.com/microsoft/botbuilder-samples.git
    ```

- In a terminal, navigate to `samples/csharp_dotnetcore/adaptive-dialog/09.integrating-composer-dialogs`
- Run the bot from a terminal or from Visual Studio, choose option A or B.

  A) From a terminal

  ```bash
  # run the bot
  dotnet run
  ```

  B) Or from Visual Studio

  - Launch Visual Studio
  - File -> Open -> Project/Solution
  - Navigate to `samples/csharp_dotnetcore/adaptive-dialog/09.integrating-composer-dialogs` folder
  - Select `Composer-Dialogs.csproj` file
  - Press `F5` to run the project

## Testing the bot using Bot Framework Emulator

[Bot Framework Emulator](https://github.com/microsoft/botframework-emulator) is a desktop application that allows bot developers to test and debug their bots on localhost or running remotely through a tunnel.

- Install the Bot Framework Emulator version 4.3.0 or greater from [here](https://github.com/Microsoft/BotFramework-Emulator/releases)

### Connect to the bot using Bot Framework Emulator

- Launch Bot Framework Emulator
- File -> Open Bot
- Enter a Bot URL of `http://localhost:3978/api/messages`

## Further reading

- [Bot Framework Composer](https://github.com/microsoft/botframework-composer)
- [Adaptive dialogs](https://aka.ms/adaptive-dialogs)
- [Language generation](https://aka.ms/language-generation)
- [Adaptive Expressions](https://aka.ms/adaptive-expressions)
- [.lu file format](https://aka.ms/lu-file-format)
- [.lg file format](https://aka.ms/lg-file-format)
- [.qna file format](https://aka.ms/qna-file-format)
- [Bot Framework Documentation](https://docs.botframework.com)
- [Bot Basics](https://docs.microsoft.com/azure/bot-service/bot-builder-basics?view=azure-bot-service-4.0)
- [Dialogs](https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-concept-dialog?view=azure-bot-service-4.0)
- [Dialog class reference](https://docs.microsoft.com/en-us/javascript/api/botbuilder-dialogs/dialog)
- [Manage complex conversation flows with dialogs](https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-dialog-manage-complex-conversation-flow?view=azure-bot-service-4.0)
- [Activity processing](https://docs.microsoft.com/en-us/azure/bot-service/bot-builder-concept-activity-processing?view=azure-bot-service-4.0)
- [Azure Bot Service Introduction](https://docs.microsoft.com/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0)
- [Azure Bot Service Documentation](https://docs.microsoft.com/azure/bot-service/?view=azure-bot-service-4.0)
- [.NET Core CLI tools](https://docs.microsoft.com/en-us/dotnet/core/tools/?tabs=netcore2x)
- [Azure CLI](https://docs.microsoft.com/cli/azure/?view=azure-cli-latest)
- [Azure Portal](https://portal.azure.com)
- [Language Understanding using LUIS](https://docs.microsoft.com/en-us/azure/cognitive-services/luis/)
- [Channels and Bot Connector Service](https://docs.microsoft.com/en-us/azure/bot-service/bot-concepts?view=azure-bot-service-4.0)

[s1]:../19.custom-dialogs/README.md
[composer]:https://github.com/microsoft/botframework-composer